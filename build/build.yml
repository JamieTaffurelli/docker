parameters:
  poolName: ""

jobs:
  - job:
    timeoutInMinutes: 120
    pool:
      vmImage: ${{ parameters.poolName }}
    steps:

      - task: Docker@2
        inputs:
          containerRegistry: 'dockerhub'
          repository: 'azuredevops'
          command: 'buildAndPush'
          Dockerfile: 'azuredevops/Dockerfile'
          buildContext: 'azuredevops'
          tags: |
            $(Build.SourceBranch)
            $(Build.BuildId)
            latest
          arguments: '--platform windows --output $(Build.ArtifactStagingDirectory)\azuredevops'

      - task: PublishPipelineArtifact@1
        displayName: "Publish Azure DevOps Image"
        inputs:
          targetPath: '$(Build.ArtifactStagingDirectory)\azuredevops'
          artifact: "tests"
        condition: and(succeeded(), ne(variables['Build.Reason'], 'PullRequest'))