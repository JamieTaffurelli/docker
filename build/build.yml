parameters:
  poolName: ""

jobs:
  - job:
    timeoutInMinutes: 120
    pool:
      vmImage: ${{ parameters.poolName }}
    steps:

      - task: Docker@2
        inputs:
          containerRegistry: 'dockerhub'
          repository: 'azuredevops'
          command: 'build'
          Dockerfile: 'azuredevops/dockerfile'
          buildContext: 'azuredevops'
          tags: |
            $(Build.SourceBranchName)
            $(Build.BuildId)
            latest
          arguments: '--platform windows'
      
      - task: Docker@2
        inputs:
          containerRegistry: 'dockerhub'
          repository: 'azuredevops'
          command: 'push'
          Dockerfile: 'azuredevops/dockerfile'
          tags: |
            $(Build.SourceBranch)
            $(Build.BuildId)
            latest
          arguments: '--platform windows'
      condition: and(succeeded(), ne(variables['Build.Reason'], 'PullRequest'))